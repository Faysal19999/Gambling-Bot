"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CoreListener = void 0;
const Listener_1 = require("../../../lib/structures/Listener");
const Events_1 = require("../../../lib/types/Events");
class CoreListener extends Listener_1.Listener {
    constructor(context) {
        super(context, { event: Events_1.Events.PreChatInputCommandRun });
    }
    async run(payload) {
        const { command, interaction } = payload;
        // Run global preconditions:
        const globalResult = await this.container.stores.get('preconditions').chatInputRun(interaction, command, payload);
        if (globalResult.isErr()) {
            this.container.client.emit(Events_1.Events.ChatInputCommandDenied, globalResult.unwrapErr(), payload);
            return;
        }
        // Run command-specific preconditions:
        const localResult = await command.preconditions.chatInputRun(interaction, command, payload);
        if (localResult.isErr()) {
            this.container.client.emit(Events_1.Events.ChatInputCommandDenied, localResult.unwrapErr(), payload);
            return;
        }
        this.container.client.emit(Events_1.Events.ChatInputCommandAccepted, payload);
    }
}
exports.CoreListener = CoreListener;
//# sourceMappingURL=CorePreChatInputCommandRun.js.map